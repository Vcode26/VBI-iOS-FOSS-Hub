<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WebClip Generator â€” VBI FOSS Hub</title>
  <link rel="icon" href="assets/VBI iOS FOSS Hub Favicon.png" type="image/png">

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, sans-serif;
      background: #0d0d0d;
      color: #e6e6e6;
      text-align: center;
    }

    header {
      padding: 30px 0;
      background: #111;
      border-bottom: 1px solid #222;
    }

    h1 {
      margin: 0;
      font-size: 2.4rem;
      letter-spacing: 1px;
      font-weight: 700;
    }

    nav {
      margin-top: 10px;
      font-size: 1.1rem;
    }

    nav a {
      color: #4da3ff;
      text-decoration: none;
      margin: 0 10px;
    }

    nav a:hover {
      text-decoration: underline;
    }

    .card {
      background: #141414;
      border: 1px solid #222;
      border-radius: 12px;
      padding: 20px;
      margin: 25px auto;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 0 20px rgba(0,0,0,0.4);
      text-align: left;
    }

    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
      color: #e6e6e6;
    }

    input, textarea, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 8px;
      border: 1px solid #333;
      background: #1a1a1a;
      color: #e6e6e6;
    }

    button {
      background: #4da3ff;
      border: none;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      margin-top: 20px;
    }

    button:hover {
      background: #6bb6ff;
    }

    pre {
      background: #1a1a1a;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #333;
      white-space: pre-wrap;
      color: #bfbfbf;
    }

    #pagesLink {
      display: none;
      background: #e8f5e9;
      color: #1b5e20;
      padding: 15px;
      border-left: 4px solid #2e7d32;
      margin-top: 20px;
      border-radius: 8px;
    }

    #instructions {
      background: #0f1a26;
      padding: 15px;
      border-left: 4px solid #4da3ff;
      margin-bottom: 25px;
      border-radius: 8px;
      color: #cfe8ff;
    }

    a {
      color: #4da3ff;
    }
  </style>
</head>

<body>

  <header>
    <h1>VBI FOSS Hub</h1>
    <nav>
      <a href="../index.html">Home</a> |
      <a href="https://vbifoss.pages.dev/Devconnect">Devconnect</a>
    </nav>
  </header>

  <div class="card" id="instructions">
    <strong>How to use the WebClip Generator:</strong><br><br>
    1. Fill out the form below.<br>
    2. Click <strong>Download .mobileconfig</strong> to save the file.<br>
    3. Upload the file to your GitHub repo:<br>
    <a href="https://github.com/Vcode26/VBI-iOS-FOSS-Hub/upload/main" target="_blank">
      Upload to VBI-iOS-FOSS-Hub
    </a><br><br>
    4. After upload, your install link will be:<br>
    <code>https://vbifoss.pages.dev/&lt;filename&gt;.mobileconfig</code><br><br>
    5. Use the button below to auto-generate that link.
  </div>

  <div class="card">
    <label>Name</label>
    <input id="name" type="text" placeholder="Viaan">

    <label>URL</label>
    <input id="url" type="text" placeholder="https://example.com">

    <label>Icon (Upload File)</label>
    <input id="iconFile" type="file" accept="image/*">

    <label>Icon (Base64 Output)</label>
    <textarea id="icon" placeholder="Base64 will appear here automatically"></textarea>

    <label>Fullscreen</label>
    <input id="fullscreen" type="checkbox">

    <label>Filename</label>
    <input id="filename" type="text" placeholder="com.example.webclip">

    <button onclick="generate()">Generate Mobileconfig JSON</button>
    <button onclick="downloadConfig()">Download .mobileconfig</button>
    <button onclick="showPagesLink()">Generate Cloudflare Pages Link</button>

    <div id="pagesLink"></div>

    <h2>Output</h2>
    <pre id="output"></pre>
  </div>

<script>
function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => {
      const base64 = reader.result.split(",")[1];
      resolve(base64);
    };
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

document.getElementById("iconFile").addEventListener("change", async (event) => {
  const file = event.target.files[0];
  if (!file) return;

  const base64 = await fileToBase64(file);
  document.getElementById("icon").value = base64;
});

function generateUUID() {
  return crypto.randomUUID();
}

function buildPayload() {
  const name = document.getElementById("name").value.trim();
  const url = document.getElementById("url").value.trim();
  const icon = document.getElementById("icon").value.trim();
  const fullscreen = document.getElementById("fullscreen").checked;
  const filename = document.getElementById("filename").value.trim();

  const uuid1 = generateUUID();
  const uuid2 = generateUUID();

  const xml = `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
  <key>PayloadContent</key>
  <array>
    <dict>
      <key>FullScreen</key>
      ${fullscreen ? "<true/>" : "<false/>"}
      <key>Icon</key>
      <data>${icon}</data>
      <key>Label</key>
      <string>${name}</string>
      <key>PayloadIdentifier</key>
      <string>com.webclip.${name}.${uuid1}</string>
      <key>PayloadType</key>
      <string>com.apple.webClip.managed</string>
      <key>PayloadUUID</key>
      <string>${uuid1}</string>
      <key>PayloadVersion</key>
      <integer>1</integer>
      <key>URL</key>
      <string>${url}</string>
    </dict>
  </array>

  <key>PayloadDisplayName</key>
  <string>${name} WebClip</string>
  <key>PayloadIdentifier</key>
  <string>com.webclip.${name}.profile</string>
  <key>PayloadType</key>
  <string>Configuration</string>
  <key>PayloadUUID</key>
  <string>${uuid2}</string>
  <key>PayloadVersion</key>
  <integer>1</integer>
</dict>
</plist>`;

  return { xml, filename };
}

function generate() {
  const payload = buildPayload();
  document.getElementById("output").textContent = JSON.stringify(payload, null, 2);
}

function downloadConfig() {
  const { xml, filename } = buildPayload();

  const blob = new Blob([xml], { type: "application/x-apple-aspen-config" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = filename + ".mobileconfig";
  a.click();

  URL.revokeObjectURL(url);
}

function showPagesLink() {
  const filename = document.getElementById("filename").value.trim();
  if (!filename) {
    alert("Enter a filename first");
    return;
  }

  const link = `https://vbifoss.pages.dev/${filename}.mobileconfig`;

  const div = document.getElementById("pagesLink");
  div.style.display = "block";
  div.innerHTML = `
    <strong>Your Cloudflare Pages link:</strong><br>
    <a href="${link}" target="_blank">${link}</a><br><br>
    <em>Upload the downloaded .mobileconfig file to your GitHub repo for this link to work.</em>
  `;
}
</script>

</body>
</html>
